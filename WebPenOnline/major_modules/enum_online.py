import socket
import requests
from minor_modules import send_text


def doEnum(target, chat_id):
    target_ip = socket.gethostbyname(target)
    #Enumerating Subdomains
    r = requests.get('https://api.hackertarget.com/hostsearch/?q=' +target)
    sub = r.text
    string = ''.join((element for element in sub if not element.isdigit()))
    final_subdomain = string.replace(',...', '')
    send_text.send_msg("Enumerating Subdomains Done....", chat_id)
    

    #Finding WaybackUrls
    r = requests.get(url='http://web.archive.org/cdx/search/cdx?url=*.' + target + '/*&output=json&fl=original&collapse=urlkey')
    r1 = r.text
    r2 = r1.replace('[', '')
    r3 = r2.replace(']', '')
    r4 = r3.replace('"', '')
    result_waybackurl = r4.replace(',', '')
    send_text.send_msg("Finding WaybackUrls Done....", chat_id)

    send_text.send_msg("Enumeration Completed For Target " + target, chat_id)
    

    done = '[*]----- Enumeration Completed -----[*]\n\n[*] Target : ' + target + '\n[*] Target IP : ' + target_ip + '\n\n[*]---------- Enumerating Subdomains ----------[*]\n' + final_subdomain + '\n\n[*]---------- Finding WaybackUrls ----------[*]\n' + result_waybackurl
    return done
